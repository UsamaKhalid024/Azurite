"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e,t,n){"object"==("undefined"==typeof module?"undefined":_typeof(module))&&"object"==_typeof(module.exports)?module.exports=function(e,t){return e.integrationSettings=e.ISP=n(e,t,!0)}:e.integrationSettings=e.ISP=n(e,t)}("undefined"==typeof fs?{}:fs,"undefined"==typeof window?void 0:window,function(e,t,n){var i={accountTypes:{Azure:{name:"Azure Blob",header:null,internalName:"Azure",icon:"azureIcon",showUpdateButton:!0,supportUrl:"https://sfapphelp.formstack.com/hc/en-us/articles/360018681752-File-Upload-Field#AzureAccount",inputFields:{Secret:{guiLabel:"Account Name",fieldType:"",required:!0,jsonVal:!1},Key:{guiLabel:"Secret Key",fieldType:"password",required:!0,jsonVal:!1}}},AWSS3:{name:"AWS",header:"Amazon Web Services",internalName:null,icon:"awsIcon",supportUrl:"https://sfapphelp.formstack.com/hc/en-us/articles/360018681752-File-Upload-Field#AWSAccount",inputFields:{Key:{guiLabel:"Access Key ID",fieldType:"",required:!0,jsonVal:!1},Secret:{guiLabel:"Secret Access Key",fieldType:"password",required:!0,jsonVal:!1},Region:{guiLabel:"Region",fieldType:"select",required:!0,jsonVal:!0,options:'{ "options": [{ "value": "APEast1", "name": "Asia Pacific (Hong Kong)" }, { "value": "APNortheast1", "name": "Asia Pacific (Tokyo)" }, { "value": "APNortheast2", "name": "Asia Pacific (Seoul)" },{ "value": "APNortheast3", "name": "Asia Pacific (Osaka-Local)" }, { "value": "APSouth1", "name": "Asia Pacific (Mumbai)" }, { "value": "APSoutheast1", "name": "Asia Pacific (Singapore)" }, { "value": "APSoutheast2", "name": "Asia Pacific (Sydney)" }, { "value": "CACentral1", "name": "Canada (Central)" },{ "value": "CNNorth1", "name": "China (Beijing)" },{ "value": "CNNorthWest1", "name": "China (Ningxia)" }, { "value": "EUCentral1", "name": "EU (Frankfurt)" }, { "value": "EUNorth1", "name": "EU (Stockholm)" }, { "value": "EUWest1", "name": "EU (Ireland)" }, { "value": "EUWest2", "name": "EU (London)" }, { "value": "EUWest3", "name": "EU (Paris)" }, { "value": "MESouth1", "name": "Middle East (Bahrain)" }, { "value": "SAEast1", "name": "South America (Sao Paulo)" }, { "value": "USEast1", "name": "US East (N. Virginia)" }, { "value": "USEast2", "name": "US East (Ohio)" }, { "value": "USGovCloudEast1", "name": "US GovCloud East (Virginia)" }, { "value": "USGovCloudWest1", "name": "US GovCloud West (Oregon)" }, { "value": "USWest1", "name": "US West (N. California)" }, { "value": "USWest2", "name": "US West (Oregon)" }] }'}}},Dropbox:{name:"Dropbox",header:null,internalName:null,icon:"dropbox",supportUrl:"https://sfapphelp.formstack.com/hc/en-us/articles/360018681752-File-Upload-Field#DropBoxAccount",inputFields:{Email:{guiLabel:"You have granted Formstack access to your Dropbox account:",fieldType:"label",required:!1,jsonVal:!0},Key:{guiLabel:"",fieldType:"hidden",required:!1,jsonVal:!1}},showUpdateButton:!1,button:{ButtonText:"Log in with a different account",id:"btn2233",class:"fsbutton flotLeft",onClick:"fsLightbox2233.reload();",type:"hyperlink",href:"",fsFunction:'window.addEventListener("message", (event)=>{ fs.ISP.tokenReceiver(this,event);});',javascript:{type:"fsLightbox",functionName:"fsLightbox2233",form:"2233",handleText:"Connected to Dropbox",handlePosition:"left",handleImage:"",handle:null,iframe:{id:"2233",src:"",title:"Connected to Dropbox"}}}},FormstackDocuments:{name:"Formstack Documents",header:null,internalName:"FormstackDocuments",icon:"formstackDocuments",showUpdateButton:!0,supportUrl:"https://sfapphelp.formstack.com/hc/en-us/articles/360018681752-File-Upload-Field#FormstackDocumentAccount",inputFields:{Key:{guiLabel:"Api Key",fieldType:"password",required:!0,jsonVal:!1},Secret:{guiLabel:"Api Secret",fieldType:"password",required:!0,jsonVal:!1}}},Stash:{name:"Stash",header:"Stash (By Formstack)",internalName:null,icon:"stashIcon",showUpdateButton:!0,supportUrl:"https://sfapphelp.formstack.com/hc/en-us/articles/360018681752-File-Upload-Field#StashAccount",inputFields:{Secret:{guiLabel:"Account Name",fieldType:"",required:!0,jsonVal:!1},Key:{guiLabel:"Secret Key",fieldType:"password",required:!0,jsonVal:!1}}},default:{name:"Integration",header:null,internalName:null,icon:"",supportUrl:"",showUpdateButton:!0,inputFields:{Key:{guiLabel:"Account Id",fieldType:"",required:!0},Secret:{guiLabel:"Password",fieldType:"password",required:!0,jsonVal:!1}}}}};var a=new Map;var o=function(e){var t,n,i="";for(n=e.options.length,t=0;t<n;t++)i+="<option value = "+e.options[t].value+"> "+e.options[t].name+" </option>";return i},s=function(e){if(e){var t="";return 0==e.showUpdateButton?t+='<button type="button" class=\'displaynone fsbutton fsbuttonUpdate \' tabindex="0">Update</button>':t+='<button type="button" class=\'fsbutton fsbuttonUpdate\' tabindex="0">Update</button>',e.button&&(t+=r(e.button)),t}},r=function(e){if(e){var t="";if("hyperlink"==e.type){var n=$("<a />",{class:e.class}),i=$("<span />",{class:"fsBtn__text",text:e.ButtonText});if(n.attr("id",e.id),n.attr("href",e.href),n.attr("onClick",e.onClick),n.append(i),n.attr("target","_blank"),"fsLightbox"==e.javascript.type){var a=initIframe(e.javascript.iframe);delete e.javascript.iframe;var o=JSON.stringify(e.javascript);n.attr("fsEvent",o),n.attr("fsFunction",e.fsFunction),t+=a.outerHTML}t+=n[0].outerHTML}return t}},l={prod:{getIntegrations:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};t.Visualforce.remoting.Manager.invokeAction(t.REMOTE_ACTIONS.getAllIntegrations,function(t,n){var i={httpStatus:0,serviceInformation:[]};if(n.status)for(var a in i.httpStatus=n.statusCode,t.Result)"object"==_typeof(t.Result[a])&&i.serviceInformation.push(t.Result[a]);else i.message=n.message;e(i)})},updateIntegration:function(e){var n=Object.keys(e.iDivTemplate.inputFields),i={RecordId:e.serviceInformation.RecordId,ProviderType:e.serviceInformation.ProviderType,IsActive:e.serviceInformation.IsActive},a="",o={};void 0===i.FieldConfiguration&&(i.FieldConfiguration="");for(var s=0;s<n.length;s++){var r=n[s],l=e.iDivTemplate.inputFields[r];0==y(l)?i[r]=e.dom.getElementsByClassName("inputField "+r)[0].value:"select"==l.fieldType?o[r]=e.dom.getElementsByClassName("inputField "+r+(l.jsonVal?" select2-offscreen":""))[0].value:o[r]=e.dom.getElementsByClassName("inputField "+r)[0].value,(void 0!==i[r]&&!i[r].split(" ").join("").length&&l.required||void 0!==o[r]&&!o[r].split(" ").join("").length&&l.required)&&(a+=(a.length?", ":"")+l.guiLabel)}if(i.FieldConfiguration=JSON.stringify(o),i.FieldConfiguration.length&&n.push("FieldConfiguration"),a.length){var d="The following fields are required to update "+e.iDivTemplate.name+": "+a;return i.message=d,i.httpStatus=400,e.updateDomInformation(i),void t.showPillMessage_Error(d,!0,t.document.getElementsByClassName("integrationPillMessage")[0])}t.Visualforce.remoting.Manager.invokeAction(t.REMOTE_ACTIONS.updateIntegration,i,function(t,a){var o={httpStatus:!!a.status&&a.statusCode,message:a.message};n.forEach(function(e){return o[e]=i[e]}),t&&(o.ModifiedBy=t.Result.ModifiedBy,o.LastModified=t.Result.LastModified,o.ModifiedByUserId=t.Result.ModifiedByUserId),e.updateDomInformation(o,!t),t?b()?C(e):(console.log("Integration saved in Salesforce, saving in Azure"),e.listenerCollection.publishIntegration(e)):E(e)})},publishIntegration:function(e){t.Visualforce.remoting.Manager.invokeAction(t.REMOTE_ACTIONS.publishIntegration,e.serviceInformation.RecordId,function(t,n){console.log("[publishIntegration] Response["+t+"]"),t?C(e):E(e)})},deleteIntegration:function(e){t.Visualforce.remoting.Manager.invokeAction(t.REMOTE_ACTIONS.deleteIntegration,e.serviceInformation.RecordId,function(n,i){if(n){if(0==n.IsValid){var a=n.ErrorMessage.replace(/([.?!])\s*(?=[A-Z])/g,"$1|").split("|");t.commonAlertMessage(a[0],a[1],"OK")}else if(1==n.IsValid){var o=e.iDivTemplate.name;e.delete(),t.showPillMessage_Success("Successfully removed "+o,!0,t.document.getElementsByClassName("integrationPillMessage")[0])}}else t.showPillMessage_Error("There was a problem deleting the integration, please try again later.",!0,t.document.getElementsByClassName("integrationPillMessage")[0])})}},test:"object"==_typeof(e.ISP)&&"function"==typeof e.ISP.__testFunctions?new e.ISP.__testFunctions(i):{}};function d(e){for(var t=e;-1==t.className.indexOf("integrationContainer")||"BODY"==t.tagName;)t=t.parentElement;return"BODY"==t.tagName?void 0:a.get(t)}var u={arrowBtnClick:function(){var e=this.className.indexOf("expandButton")>-1;this.classList.remove(e?"expandButton":"contractButton"),this.classList.add(e?"contractButton":"expandButton");for(var t=this.parentElement;-1==t.className.indexOf("integrationContainer")||"BODY"==t.tagName;)t=t.parentElement;t.getElementsByClassName("integrationExpandBox")[0].style.display=e?"block":"none",d(this).dom.getElementsByClassName("integrationDiv")[0].classList[e?"add":"remove"]("iDivExpanded")},integrationUpdateBtn:function(e){e.preventDefault(),u.integrationUpdate(d(this))},inputFieldChangeIntegrationUpdate:function(e){"Enter"==e.key&&u.integrationUpdate(d(this))},integrationUpdate:function(e){var t,n=!1;if(-1==(t=e.dom.getElementsByClassName("fsbuttonUpdate")[0]).className.indexOf("disabled"))for(var i in e.iDivTemplate.inputFields)if(0==y(e.iDivTemplate.inputFields[i])&&void 0!==e.serviceInformation[i]&&e.serviceInformation[i]!=e.dom.getElementsByClassName("inputField "+i)[0].value)n=!0;else if(1==y(e.iDivTemplate.inputFields[i])){var a;a="string"==typeof e.serviceInformation.FieldConfiguration?JSON.parse(h(e.serviceInformation.FieldConfiguration)):e.serviceInformation.FieldConfiguration,(void 0==_typeof(a[i])||void 0===a||void 0!==a&&a[i]!=e.dom.getElementsByClassName("inputField "+i)[0].value)&&(n=!0)}-1==(t=e.dom.getElementsByClassName("fsbutton")[0]).className.indexOf("disabled")&&1==n&&(t.classList.add("disabled"),e.listenerCollection.updateIntegration(e))},integrationDeleteBtn:function(){var e=this,t="Are you sure you want to delete this integration account?",n=function(){var t=d(e);t.listenerCollection.deleteIntegration(t)};"function"==typeof confirmDialogWithCallback?confirmDialogWithCallback(t,"",{},n):confirm(t)&&n()},pseudoButton:function(e){["Enter"," "].indexOf(e.key)>-1&&(e.preventDefault(),e.target.click())}};function c(e,n){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.iDivTemplate=e,this.serviceInformation=n,this.dom=function(e){var n="";for(var i in e.inputFields){var a=e.inputFields[i];if("select"==a.fieldType){var r=JSON.parse(a.options),l=o(r);n+='<tr><td class="credentialTable__labelColumn">'+a.guiLabel+(a.required?'<span class="ff-required-mark">*</span>':"")+'</td><td ><select class="inputField '+i+'"/>'+l+"</select></td></tr>"}else"label"==a.fieldType?n+="<tr><td>"+a.guiLabel+(a.required?'<span class="ff-required-mark">*</span>':"")+'</td><td><label class="readOnly inputField '+i+'" type="'+a.fieldType+'" readonly /></td></tr>':"hidden"==a.fieldType?n+='<tr style="display:none"><td>'+a.guiLabel+(a.required?'<span class="ff-required-mark">*</span>':"")+'</td><td><input class="inputField '+i+'" type="'+a.fieldType+'"/></td></tr>':n+='<tr><td class="credentialTable__labelColumn">'+a.guiLabel+(a.required?'<span class="ff-required-mark">*</span>':"")+'</td><td><input class="inputField '+i+'" type="'+a.fieldType+'"/></td></tr>'}var d=t.document.createElement("div"),c=e.header?e.header:e.name;return d.className="integrationBlockContainer",d.innerHTML='<div class="integrationDiv">\n                <table>\n                    <tbody>\n                        <tr>\n                            <td title="'+c+'" class="iDivIcon '+(e.icon?e.icon:"default")+"\"></td>\n                            <td class='connectionMsg'>Connected to "+c+'</td>\n                            <td class=\'arrowBtn expandButton\' tabindex="0"></td>\n                        </tr>\n                    </tbody>\n                </table>\n                <div class="rightHandContainer">\n                    <span class="lastUpdated"></span>\n                    <div class=\'iDivIcon delete\' tabindex="0"></div>\n                </div>\n            </div>\n            <div class="integrationExpandBox" style=\'display:none\'>\n                '+(e.supportUrl?"<div class='supportPageInfo'>For more information on "+e.name+" integration check out the <a href='"+e.supportUrl+"' target='_blank'>support page</a></div>":"")+"<table class='credentialTable'>\n                    <tbody>"+n+"\n                    </tbody>\n                </table>\n                "+s(e)+"\n            </div>\n            \n        </div>",d.getElementsByClassName("arrowBtn")[0].addEventListener("click",u.arrowBtnClick),d.dataset.integrationName=e.name,d}(this.iDivTemplate),this.domContainer=t.document.createElement("div"),this.domContainer.className="integrationContainer",this.domContainer.innerHTML='<h3 class="integrationTitle">'+this.iDivTemplate.name+"</h3>",this.domContainer.appendChild(this.dom),a.set(this.domContainer,this),this.listenerCollection=l[i?"test":"prod"],this.updateDomInformation=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.serviceInformation,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(var n in e)this.serviceInformation[n]=e[n];var i=this.serviceInformation;for(var n in this.iDivTemplate.inputFields){var a;if(!i[n]&&this.iDivTemplate.inputFields[n].jsonVal)if(a="string"==typeof i.FieldConfiguration?JSON.parse(h(i.FieldConfiguration)):i.FieldConfiguration,"select"==this.iDivTemplate.inputFields[n].fieldType){var o=this.dom.getElementsByClassName("inputField "+n)[0],s=o.options;void 0==s&&(s=(o=this.dom.getElementsByClassName("inputField "+n+" select2-offscreen")[0]).options);for(var r=s.length,l=0;l<r;l++){if(s[l].value==a[n]){o.selectedIndex=l;break}}}else"label"==this.iDivTemplate.inputFields[n].fieldType&&(void 0===a?this.dom.getElementsByClassName("inputField "+n)[0].parentElement.parentElement.style.display="none":this.dom.getElementsByClassName("inputField "+n)[0].innerHTML=a[n]);else i[n]&&(this.dom.getElementsByClassName("inputField "+n)[0].value=i[n])}var d=["Last updated",""," on "],u=!1;if(i.ModifiedBy){var c=i.ModifiedBy;i.ModifiedByUserId&&(c='<a href="/'+i.ModifiedByUserId+'">'+c+"</a>"),d[1]+=": by "+c,u=!0}if(i.LastModified&&(d[2]+=i.LastModified,u=!0),u&&(this.dom.getElementsByClassName("lastUpdated")[0].innerHTML=d.join("")),400==this.serviceInformation.httpStatus||!1===this.serviceInformation.httpStatus?(this.dom.classList.add("error"),this.serviceInformation.message&&console.error("[IntegrationSettings] Integration not updated: "+this.serviceInformation.message)):this.dom.classList.remove("error"),t){var p=this.dom.getElementsByClassName("fsbuttonUpdate")[0];p&&p.classList.remove("disabled")}},this.delete=function(){a.delete(this.domContainer),this.domContainer.parentElement&&this.domContainer.parentElement.removeChild(this.domContainer)};var r=this.dom.getElementsByClassName("integrationExpandBox")[0].getElementsByClassName("fsbuttonUpdate")[0];r&&r.addEventListener("click",u.integrationUpdateBtn),this.dom.getElementsByClassName("iDivIcon delete")[0].addEventListener("click",u.integrationDeleteBtn);for(var d=this.dom.getElementsByClassName("inputField"),c=0;c<d.length;c++)d[c].addEventListener("keydown",u.inputFieldChangeIntegrationUpdate);var p=["fsbuttonUpdate","expandButton","iDivIcon delete"];for(c=0;c<p.length;c++)for(var m=this.dom.getElementsByClassName(p[c]),f=0;f<m.length;f++)m[f].addEventListener("keydown",u.pseudoButton);this.updateDomInformation()}var p=t.document.createElement("div");p.className="integrationBlockContainer error",p.innerHTML="<div class='fs_pillmessage fs_pillmessage--error' style='text-align:center'><span class='fs_pillmessage__text'>Something went wrong when loading the integration settings. <a class='tryAgainLink'>Please try again.</a></span></div>",p.getElementsByClassName("tryAgainLink")[0].addEventListener("click",function(){return v("previous")});var m=t.document.createElement("div");m.className="integrationBlockContainer",m.innerHTML="<div class='integrationDiv' style='text-align:center'>No Formstack integrations are in use on this org.</div>";var f=function(){},g=!1;function v(e,n,o,s){if(!g){g=!0,"previous"==e?e=f:f=e,d=s,i.accountTypes.Dropbox.button.href="https://www.dropbox.com/oauth2/authorize?client_id="+t.dropboxKey+"&response_type=code&redirect_uri="+d+"/Integration/IntegrationAuthorized",i.accountTypes.Dropbox.button.javascript.iframe.src=d+"/Integration/AuthorizeIntegration?IntegrationType=Dropbox";try{p.parentElement&&p.parentElement.removeChild(p),m.parentElement&&m.parentElement.removeChild(m),n&&a.forEach(function(e){return e.delete()});var r=[];f=e,l[o?"test":"prod"].getIntegrations(function(n){if(200==n.httpStatus){for(var a in n.serviceInformation)if("object"==_typeof(n.serviceInformation[a])){var s=new c(i.accountTypes[n.serviceInformation[a].ProviderType]?i.accountTypes[n.serviceInformation[a].ProviderType]:i.accountTypes.default,n.serviceInformation[a],o);r.push(s.domContainer)}n.serviceInformation.length||r.push(m)}else r.push(p),console.error("[integrationSettings] failed to load integrations: - ",n.message);e(r),g=!1,function(){for(var e=document.querySelectorAll("[fsEvent]"),n=0;n<e.length;n++){var i=e[n].getAttribute("fsEvent"),a=JSON.parse(i);if(a&&"fsLightbox"==a.type){var o=a.functionName;t[o]=new FSLightbox(a)}}for(var s=document.querySelectorAll("[fsFunction]"),n=0;n<s.length;n++){var r=s[n].getAttribute("fsFunction");if(r){var l=new Function("return "+r);s[n].addEventListener("click",l)}}$("select.inputField").select2()}(),"function"==typeof t.$&&t.$().select2&&t.$("select.inputField").select2()})}catch(t){console.error("[integrationSettings] ",t),e([p]),g=!1}}var d}function h(e){return void 0!==e&&null!=e?(e+="".replace(/&amp;/g,"&")).replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&apos;/g,"'").replace(/&#039;/g,"'").replace(/&#38;/g,"&").replace(/&#39;/g,"'"):""}var y=function(e){var t=!1;return void 0!==e.jsonVal&&1==e.jsonVal&&(t=!0),t},b=function(){return"NativeCloud"==t.packageTier},C=function(e){t.showPillMessage_Success("Successfully updated "+e.iDivTemplate.name,!0,t.document.getElementsByClassName("integrationPillMessage")[0]);var n=e.dom.getElementsByClassName("contractButton");n.length&&n[0].click(),I(e)},E=function(e){t.showPillMessage_Error("Something went wront when trying to update "+e.iDivTemplate.name+", please try again later.",!0,t.document.getElementsByClassName("integrationPillMessage")[0]),I(e)},I=function(e){e.dom.getElementsByClassName("fsbuttonUpdate")[0].classList.remove("disabled")},S={refreshIntegrations:v,tokenReceiver:function(e,n){if(console.log("[AdminSetting] We got a message!"),void 0!=n.data&&void 0!=n.data.isValid){var i=n.data;if(i.isValid){console.log("Saving the Code!");var a={};a.Key=i.token,a.Email=i.userEmail,function(e,t){for(var n=e.parentElement;-1==n.className.indexOf("integrationContainer")||"BODY"==n.tagName;)n=n.parentElement;for(var i in t){var a=n.getElementsByClassName("inputField "+i);if(a.length){var o=t[i];a[0].value=o}}u.integrationUpdate(d(n))}(e,a)}else console.log("message is Invalid!"),console.log("response["+i+"]");$(t).off("message")}}};return n&&(S.loadedIntegrations=a,S.eventListeners=l.test,S.localScope=i),S});
//# sourceMappingURL=../../fs_assets.map